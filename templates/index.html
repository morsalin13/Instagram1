<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Username Checker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #0f1115;
            color: #e4e6eb;
        }
        .container {
            background-color: #18191a;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }
        h1 { text-align: center; }
        textarea, input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: #242526;
            border: 1px solid #3a3b3c;
            border-radius: 4px;
            color: #e4e6eb;
        }
        button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            background-color: #0095f6;
            color: white;
        }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        .login-section {
            background: #202020;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .logged-in-msg {
            background: #1e4620;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
        .result-item {
            border-bottom: 1px solid #333;
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
        }
        .status-taken { color: #ed4956; font-weight: bold; }
        .status-available { color: #2ecc71; font-weight: bold; }
        .method-tag {
            font-size: 12px;
            background: #333;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
        }
        .stats {
            text-align: right;
            margin-top: 10px;
            color: #aaa;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Instagram Username Checker</h1>

    {% if logged_in %}
        <div class="logged-in-msg">
            âœ… Logged in as <b>{{ ig_user }}</b> (Deep Scan Enabled)
            <br><br>
            <button onclick="logout()" style="background:#ed4956;">Logout</button>
        </div>
    {% else %}
        <div class="login-section">
            <h3>Login Required</h3>
            <p>You must log in with your Instagram account to use this tool.</p>
            <input type="text" id="igUsername" placeholder="Instagram Username">
            <input type="password" id="igPassword" placeholder="Instagram Password">
            <button id="loginBtn" onclick="login()">Login & Continue</button>
            <p id="loginStatus"></p>
        </div>
    {% endif %}

    <h3>Check Usernames</h3>
    <textarea id="usernamesInput" placeholder="username1&#10;username2"></textarea>
    <button id="checkBtn" onclick="checkUsernames()" {% if not logged_in %}disabled{% endif %}>
        Check Availability
    </button>

    <div id="results"></div>
</div>

<script>
async function login() {
    const u = igUsername.value;
    const p = igPassword.value;
    loginBtn.disabled = true;
    loginBtn.innerText = "Logging in...";

    const res = await fetch('/login', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({username:u, password:p})
    });
    const data = await res.json();

    if (data.success) {
        location.reload();
    } else {
        loginStatus.innerHTML = `<span style="color:red">${data.message}</span>`;
        loginBtn.disabled = false;
        loginBtn.innerText = "Login & Continue";
    }
}

async function logout() {
    await fetch('/logout', {method:'POST'});
    location.reload();
}

async function checkUsernames() {
    const names = usernamesInput.value.split('\n').map(x=>x.trim()).filter(Boolean);
    if (!names.length) return alert("Enter usernames");

    checkBtn.disabled = true;
    checkBtn.innerText = "Checking...";
    results.innerHTML = "";

    const res = await fetch('/check', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({usernames:names})
    });

    if (res.status === 401) {
        alert("Login required");
        location.reload();
        return;
    }

    const data = await res.json();
    let html = "<h3>Results:</h3>";
    let a=0,t=0;

    data.forEach(i=>{
        if(i.status==="Available") a++; else if(i.status==="Taken") t++;
        html += `
        <div class="result-item">
            <div>
                <b>${i.username}</b><br>
                ${i.followers ? `Followers: ${i.followers}<br>UID: ${i.uid}` : ""}
            </div>
            <div style="text-align:right">
                <span class="status-${i.status.toLowerCase()}">${i.status}</span><br>
                <small>${i.details}</small>
                <span class="method-tag">${i.method}</span>
            </div>
        </div>`;
    });

    html += `<div class="stats">Total: ${data.length} | Available: ${a} | Taken: ${t}</div>`;
    results.innerHTML = html;
    checkBtn.disabled = false;
    checkBtn.innerText = "Check Availability";
}
</script>
</body>
</html>
